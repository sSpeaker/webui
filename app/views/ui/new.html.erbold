<html>
<head>

<style>
 p { color:blue; margin:8px; }

  #left {
    float: left;
    width: 40%;
  }
  #center {
    float: left;
    width: 20%;
  }
  #right {
    float: right;
    width: 38%;
  }
</style>

 <script src="http://code.jquery.com/jquery-latest.js"></script>

<script>

function removeInput(divName, divName2) {
  document.getElementById("sortable").removeChild(document.getElementById(divName));
  document.getElementById("right").removeChild(document.getElementById(divName2));
}

 $("input").keyup(function () {
var value = $(this).val();
$("p").text(value);
}).keyup();

$(document).ready(function(){

  $('#dynamicInput0 a.show_hide0').click(generateHandler(0));

  $('#sortable').sortable({
    update: function(event, ui) {
      var newOrder = $(this).sortable('toArray').toString();
      document.getElementById('sort').value = newOrder;
    }
  });
});

var counter = 1;

function generateHandler(number) {
  return function() {
    if ($('.slidingDiv' + number).css('display') == 'none') {
      for (var i = 0; i <= counter; i++) {
        if ((i != number) && ($('.slidingDiv' + i).css('display') != 'none')) {
          $('.slidingDiv' + i).slideToggle();
        }
      }
    }
    $('.slidingDiv' + number).slideToggle();
  };
}

function addInput(divName, type) {
  var mainCanvasDiv = document.createElement('div');
  mainCanvasDiv.id =  'right' + counter;
  mainCanvasDiv.className = 'slidingDiv' + counter;
  mainCanvasDiv.style.display = 'none';

  var newdiv = document.createElement('div');
  newdiv.id = 'dynamicInput_' + counter;

  switch (type)
  {
  <% @hash.each do |k,v| %>
    case '<%= k %>':
      newdiv.innerHTML = '<a href="#" class="show_hide' + counter + '"><%= k %></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" onclick=removeInput("'+newdiv.id+'","'+mainCanvasDiv.id+'")><img src="/img/delete.png"></a><br><input id="text" class="slide" onclick="generateHandler('+counter+')()" type="text" name="<%= k %>_name_' + counter + '"> Name <p></p>';
      mainCanvasDiv.innerHTML = '<% v.each do |field| %><input type="text" name="<%= k %>_<%= field %>_' + counter + '"> <%= field %><br><% end %>';
    break;
  <% end %>
  }
  document.getElementById(divName).appendChild(newdiv);
  document.getElementById("right").appendChild(mainCanvasDiv);
  $('#dynamicInput_' + counter + ' show_hide' + counter).click(generateHandler(counter));
  counter++;
}
</script>
</head>

<body>
 <input type="text" value="some text"/>
<p></p>
<form action="/ui/download" method="POST">
  <div id="center">
    <% @hash.each do |key,value| %>
      <input type="button" value="Add <%= key %>" onClick="addInput('sortable', '<%= key %>');"><br>
    <% end %>
  </div>

  <div id="left">
    <div id="sortable">
      <input type="hidden" name="sort" id="sort" value="">
    </div>
    <input type=submit value="Download!">
  </div>

  <div id="right">
  </div>

</form>
</body>
</html>

<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.1.0.min.js"></script>
<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
<script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>

